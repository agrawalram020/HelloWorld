pipeline {
    agent any
    
    stages {
        stage('Write to file') { 
            steps {
                bat "echo %workbench_name%"
                bat "echo %tfvars% >> %workbench_name%.tfvars"
            }
        }

        stage('Terraform Init') { 
            steps {
                bat 'terraform init'
            }
        }

        stage('Terraform Plan') { 
            steps {
                sh 'terraform plan -var-file="%workbench_name%.tfvars"'
            }
        }
        stage('Terraform Apply') { 
            steps {
                bat 'echo "Apply"'
                sh 'terraform apply -auto-approve -var-file="%workbench_name%.tfvars"'
            }
        }

	}

}
